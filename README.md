# AI 插件化智能处理平台

## 快速启动

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 初始化数据库

```bash
python scripts/init_db.py
```

### 3. 启动服务

```bash
uvicorn app.main:app --reload
```

访问 http://127.0.0.1:8000/docs 查看 API 文档。
访问 http://127.0.0.1:8000/static/tasks.html 进入任务管理列表页。

---

# 前端管理界面使用说明文档

## 一、系统概述

### 1.1 系统名称
AI 插件化智能处理平台（AI Plugin Processing Platform）

### 1.2 系统用途
本系统旨在通过标准化的前端管理界面，提供对 AI 任务的全生命周期管理能力。用户可在此界面提交 AI 处理任务，实时监控任务流转状态，并查看最终的执行结果与处理日志。

### 1.3 技术结构概述
本系统采用前后端分离架构，核心技术组件如下：
*   **前端**：基于原生技术栈构建的管理界面，负责 Task 的可视化管理与展示。
*   **后端**：基于 FastAPI 构建的高性能 API 服务。
*   **数据层**：关系型数据库，负责 Task 的持久化存储。
*   **队列层**：Redis，负责异步任务的入队与调度。

## 二、前端页面结构总览

前端管理界面包含以下四个主要功能视图：

1.  **任务列表页（Task List）**
    *   **用途**：展示系统中所有任务的摘要信息，提供分页浏览与状态概览能力。
2.  **任务详情页（Task Detail）**
    *   **用途**：展示单个任务的完整配置信息（输入/模型/输出配置）、当前状态及生命周期时间戳。
3.  **任务结果页（Task Result）**
    *   **用途**：仅针对执行成功的任务，展示其最终产出的数据集合。
    *   *注：此视图在物理上集成于任务详情页下方。*
4.  **任务日志页（Task Logs）**
    *   **用途**：展示任务执行过程中的运行日志与调试信息。
    *   *注：此视图在物理上集成于任务详情页底部。*

## 三、任务列表页使用说明

### 3.1 对应接口
`GET /api/v1/tasks`

### 3.2 页面功能与字段
任务列表页以表格形式展示任务摘要，包含以下核心字段：

| 字段名称 | 对应数据字段 | 说明 |
| :--- | :--- | :--- |
| **任务 ID** | `task_id` | 任务的全局唯一标识符（UUID）。 |
| **状态** | `status` | 任务当前的流转状态（详见第八章）。 |
| **创建时间** | `created_at` | 任务提交的时间（已转换为本地时间格式）。 |
| **更新时间** | `updated_at` | 任务状态最后一次变更的时间（已转换为本地时间格式）。 |

### 3.3 分页行为
页面底部提供分页导航，默认行为如下：
*   **默认页码** (`page`)：1
*   **每页数量** (`page_size`)：20 条（最大支持 100 条）
*   **总数** (`total`)：显示符合条件的任务总数。

### 3.4 操作限制
*   列表页仅提供**只读**浏览功能。
*   当前版本**不提供**任务删除、编辑或手动重试功能。

## 四、任务详情页使用说明

### 4.1 对应接口
`GET /api/v1/tasks/{task_id}`

### 4.2 基础信息区块
展示任务的元数据信息：
*   **任务 ID** (`task_id`)：唯一标识。
*   **当前状态** (`status`)：实时状态，若状态为 `PENDING` 或 `PROCESSING`，页面会自动轮询刷新（3秒间隔）。
*   **时间戳**：`created_at` 与 `updated_at`。
*   **错误信息** (`error_message`)：仅当任务状态为 `FAILED` 时展示，显示具体的失败原因；其他状态下此字段隐藏。

### 4.3 任务配置区块
页面以只读 JSON 格式展示任务的三大配置项：

1.  **输入配置 (`input_config`)**
    *   定义任务的数据来源与输入参数。
2.  **模型配置 (`model_config`)**
    *   定义 AI 模型的相关参数（接口返回字段为 `model_config`）。
3.  **输出配置 (`output_config`)**
    *   定义任务结果的存储方式或回调地址。

*注：配置内容为 `Dict[str, Any]` 结构，具体字段取决于业务定义，前端不做结构解析。*

## 五、任务结果页使用说明

### 5.1 对应接口
`GET /api/v1/tasks/{task_id}/result`

### 5.2 访问条件
*   **仅可见于**：`status == SUCCESS` 的任务。
*   **不可见于**：`FAILED`、`PENDING`、`PROCESSING`、`CANCELLED` 状态的任务。

### 5.3 结果展示
*   **任务 ID** (`task_id`)：确认结果归属。
*   **结果集合** (`items`)：展示任务执行产出的所有 Item 结果。
    *   内容为 `List[Dict[str, Any]]` 格式。
    *   前端不对 `items` 内部结构进行假设，以原始 JSON 格式展示。

## 六、任务日志页使用说明

### 6.1 对应接口
`GET /api/v1/tasks/{task_id}/logs`

### 6.2 功能说明（Stub）
*   **当前状态**：接口已存在，但目前仅返回空列表 `[]`。
*   **页面表现**：页面底部会显示“执行日志”区块，但内容将始终显示“暂无日志”或空列表。
*   **特别说明**：**当前版本尚不具备实际的日志查询与展示能力**，该区域为功能预留占位。

## 七、典型使用流程

本系统的标准操作流程如下：

1.  **浏览列表**：用户进入任务列表页，查看当前系统的任务概览。
2.  **检查状态**：通过列表页的“状态”列，快速识别 `FAILED` 或 `PROCESSING` 的任务。
3.  **查看详情**：点击目标任务行的“查看”按钮，进入任务详情页。
4.  **结果验收**（针对成功任务）：
    *   若任务状态为 `SUCCESS`，滚动至页面下方的“处理结果”区块查看输出数据。
5.  **故障排查**（针对失败任务）：
    *   若任务状态为 `FAILED`，在详情页顶部的“基础信息”区块查看红色的 `error_message` 字段，获取失败原因。

## 八、状态说明与异常处理

系统状态完全由后端驱动，前端仅负责展示。

| 状态值 | 中文语义 | 前端表现 | 说明 |
| :--- | :--- | :--- | :--- |
| **PENDING** | 等待中 | 灰色 Badge | 任务已提交，正在等待队列调度。页面会自动轮询。 |
| **PROCESSING** | 处理中 | 蓝色 Badge | 任务正在执行中。页面会自动轮询。 |
| **SUCCESS** | 成功 | 绿色 Badge | 任务执行完成且无误。**可查看结果页。** |
| **FAILED** | 失败 | 红色 Badge | 任务执行出错。**可查看 `error_message`。** |
| **CANCELLED** | 已取消 | 黄色 Badge | 任务已被人工或系统取消。 |

## 九、版本限制与注意事项

### 9.1 功能限制
*   **只读属性**：前端管理界面为**纯只读**系统，不支持创建、修改、删除任务。
*   **不可配置**：所有配置项（Input/Model/Output）仅供查看，不可在界面上修改。
*   **无 WebSocket**：状态更新依赖 HTTP 轮询（间隔 3 秒），非实时推送。

### 9.2 已知问题 (Stub)
*   **日志功能不可用**：日志接口 (`/logs`) 目前为存根实现，暂无实际日志数据返回。

### 9.3 异常处理
*   若接口请求失败（如网络中断或后端服务宕机），页面将在相应区域显示红色的错误提示信息，请联系运维人员检查后端服务状态。
